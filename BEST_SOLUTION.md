# üéØ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î - Cloudflare R2

## ‚úÖ ‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å R2?

- **‡∏ü‡∏£‡∏µ 10GB** storage
- **‡∏ü‡∏£‡∏µ bandwidth** (‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤ egress)
- **‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢** ‡∏Å‡∏ß‡πà‡∏≤ Railway Volume
- **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á setup volume**

## üöÄ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô (3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á R2 Bucket ‡πÅ‡∏•‡∏∞ API Token

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://dash.cloudflare.com/
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **R2** ‚Üí **Create bucket**
3. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠: `pim-videos`
4. ‡∏™‡∏£‡πâ‡∏≤‡∏á **API Token**:
   - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Manage R2 API Tokens**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **Create API token**
   - ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠: `pim-videos-upload`
   - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å permissions: **Object Read & Write**
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **Create API Token**
   - **‡πÄ‡∏Å‡πá‡∏ö credentials ‡πÑ‡∏ß‡πâ** (Account ID, Access Key ID, Secret Access Key)

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)**
```powershell
.\setup-r2-complete.ps1
```
‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡∏ñ‡∏≤‡∏° credentials ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏ó‡∏≥‡πÄ‡∏≠‡∏á**
```powershell
# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ credentials
.\server\scripts\setup-r2-env.ps1

# ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
cd server
npm install @aws-sdk/client-s3
node scripts/upload-videos-to-r2.js

# ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï URL
node scripts/update-video-urls-to-r2.js
```

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà R2 Dashboard ‚Üí Bucket `pim-videos` ‚Üí **Settings** ‚Üí **CORS**
2. ‡∏Ñ‡∏•‡∏¥‡∏Å **Add CORS rule**
3. ‡πÉ‡∏™‡πà:
   ```
   Allowed Origins: *
   Allowed Methods: GET, HEAD
   Allowed Headers: *
   ```
4. **Save**

## ‚úÖ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à

1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: `node server/scripts/check-video-urls.js`
2. ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô URL ‡πÄ‡∏õ‡πá‡∏ô R2 URLs ‡πÅ‡∏•‡πâ‡∏ß
3. ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ!

## üìù ‡∏™‡∏£‡∏∏‡∏õ

**‡πÉ‡∏ä‡πâ:** Cloudflare R2 (‡∏ü‡∏£‡∏µ 10GB, ‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤ bandwidth)

**‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:**
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á R2 bucket + API token
2. ‡∏£‡∏±‡∏ô `setup-r2-complete.ps1`
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS

**‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!** üéâ

